
;
;  File open:
;  >>>>  01-cell_and_vanadium-w1w5.prox  <<<<
;

; Set experiment:
RDSET,inst="IN5"

;

; ---------------------------------------------------------------------
;
;   *)             Define some constants
;
; ---------------------------------------------------------------------

s  = '1-16,357-362'     ; bad spectra numbers to remove... 
v  =  0.890             ; vanadium transmission


; ---------------------------------------------------------------------
;
;   1)             Empty Cell 1 at 150 K
;
; ---------------------------------------------------------------------
; 1.1) load data (already normalized to monitor or time X 1000)
; ---------------------------------------------------------------------

w1 = rdrun('123460_123463.hdf')

; ---------------------------------------------------------------------
; 1.2) remove bad spectra
; ---------------------------------------------------------------------

w1 = in5_remove_spectra(w1,badSpectra=s)

;
;

; ---------------------------------------------------------------------
;
;   2)             Empty Cell 4 at 297 K
;
; ---------------------------------------------------------------------
; 2.1) load data (already normalized to monitor or time X 1000)
; ---------------------------------------------------------------------

w2 = rdrun('123471_123472.hdf')

; ---------------------------------------------------------------------
; 2.2) remove bad spectra
; ---------------------------------------------------------------------

w2 = in5_remove_spectra(w2, badSpectra = s)

;
;

; ---------------------------------------------------------------------
;
;   3)             Vanadium at 160 K
;
; ---------------------------------------------------------------------
; 3.1) load sample (already normalized to monitor or time X 1000)
; ---------------------------------------------------------------------

w3 = rdrun('123535_123536.hdf')

; ---------------------------------------------------------------------
; 3.2) remove bad spectra
; ---------------------------------------------------------------------

w3 = in5_remove_spectra(w3, badSpectra = s)

; ---------------------------------------------------------------------
; 3.3) vanadium correction to empty cell
; ---------------------------------------------------------------------

w4 = w3 - v * w1
e4 = sqrt(e3^2 + (v * e1)^2)

; ---------------------------------------------------------------------
;  3.4) Correct for self-shielding/self-absorption
;  (VF. Sears like) for vanadium
;
; thick   = thickness
; angle   = slab angle
; rin     = cylinder inner radius [mm]
; rout    = cylinder outer radius [mm]
; sigma_a = absorption cross section
; sigma_s = total scattering cross section
; rho     = density
; Mass    = atomic mass
;
; ---------------------------------------------------------------------

w5 = in5_safcorr(w4, thick=1, angle=135.0, sigma_a = 14.1389, sigma_s = 5.2054, rho = 5.96, Mass = 50.942)